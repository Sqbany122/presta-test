var sensbitdpd=function(c,e,t){var d={module:"",text_choose_point:"",text_point_cod:"",loaded:!1,id_interval:!1,use_desintifier:!1,carriers:[],carriers_cod:[],point:"",point_label:"",carrier_selector:".delivery_option_radio",point_required:!1,validate_cod:0,map_is_open:!1,x13opc:!1,onepagecheckout:!1,supercheckout:!1,onepagecheckoutps:!1,wkonepagecheckout:!1,google_key:"AIzaSyDZc6Ajf0PqhUAzbktozQyHFpi5V7TZW_o",use_interval:!1,conf_btn:"button[name=processCarrier]",ps17:!1,ajax_url:"",show_chooser_below_list:!1};function s(e){return e.text}function l(e){return e.split("").reverse().join("")}function o(){var e=parseInt(c(d.carrier_selector+":checked").val());if(d.use_desintifier&&c(d.carrier_selector+":checked").val().toString().indexOf(",")<=-1&&(e=parseInt(function(e){e=e.toString();var t=parseInt(e[0]);return l((e=l(e.substr(1))).split("0".repeat(t+1)).join(","))}(e))),-1!==c.inArray(e,d.carriers)){d.point_required=!0,d.point.length<=0&&c(d.conf_btn+", input#cgv").filter(":checkbox").each(function(){c(this).prop("checked",!1),void 0!==c.uniform&&c.uniform.update(this)});var t="append";if(d.show_chooser_below_list)if(d.onepagecheckoutps){var o=c(d.carrier_selector+":checked").closest(".delivery-options");t="append"}else if(d.onepagecheckout){o=c("#carriers_section");t="after"}else if(d.supercheckout)o=c("#shipping-method");else{o=c(d.ps17?".delivery-options-list .delivery-options":".delivery_options_address");t="append"}else if(d.x13opc)o=c(d.carrier_selector+":checked").closest(".delivery_option");else if(d.onepagecheckout){(o=c(d.carrier_selector+":checked").closest("tr")).length||(o=c(d.carrier_selector+":checked").closest(".delivery_option"))}else if(d.onepagecheckoutps){o=c(d.carrier_selector+":checked").closest(".delivery-option, .delivery_option");t="after"}else if(d.supercheckout)o=c(d.carrier_selector+":checked").closest("tr");else if(d.wkonepagecheckout){o=c(d.carrier_selector).closest(".wk-shipping-list");t="append"}else{o=c(d.carrier_selector+":checked").closest(d.ps17?".delivery-option":".delivery_option");t="after"}if(d.validate_cod=-1!==c.inArray(e,d.carriers_cod)?1:0,o.is("tr")&&(t="after"),"after"===t)var n=o.parent().find("."+d.module+"."+d.validate_cod).length;else n=o.find("."+d.module+"."+d.validate_cod).length;if(!n){var i=c("#"+d.module).clone(!0);if(i.removeAttr("id"),i.addClass(d.validate_cod.toString()),d.show_chooser_below_list&&d.ps17&&i.css("margin-top","0"),d.show_chooser_below_list||!d.x13opc&&!o.is("tr"))"append"===t?o.append(i):"after"===t&&o.after(i);else{o.is("tr")||(o=o.find("tr")),i.css("margin","0");var a=o.find("td").length;o.find("td").css("border","0");var r=c('<tr><td colspan="'+a+'" style="border:0"></td></tr>');r.find("td").append(i),o.after(r)}c(i).find("."+d.module+"-point-select").not(".active").addClass("active").select2sensbitdpd({language:"pl",allowClear:!1,closeOnSelect:!0,selectOnClose:!1,width:300,ajax:{url:d.ajax_url,dataType:"json",delay:250,data:function(e){return{ajax:1,action:"searchPoints",q:e.term,is_cod:d.validate_cod,page:e.page||1}},processResults:function(e,t){t.page=t.page||1;var o=c.map(e.items,function(e){return e.id=e.name,e.text=e.label,e});return{results:o,pagination:{more:30*t.page<e.total_count}}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:1,templateResult:s,templateSelection:s})}c("."+d.module).not("."+d.validate_cod).hide(),c("."+d.module+"."+d.validate_cod).show(),d.validate_cod&&d.point_required&&0<d.point.length&&p.updatePoint(d.point,"."+d.module+"-point-select")}else c("."+d.module).hide(),d.point_required=!1}function n(){if(!(d.hide_map||d.validate_cod&&c("."+d.module+"-map-container").hasClass("cod"))){if(!d.validate_cod&&c("."+d.module+"-map-container").hasClass("cod"))c("."+d.module+"-map-container").removeClass("cod");else if(!d.validate_cod&&c("."+d.module+"-map-container").length&&!c("."+d.module+"-map-container").hasClass("cod"))return;c("."+d.module+"-map-container").remove(),c("body").append("<div class='"+d.module+"-map-container'><div id='sensbitdpd-pudo-widget'></div></div>"),c("."+d.module+"-map-container").click(function(e){c(e.target).parents("."+d.module+"-map-container").length||(c(this).fadeOut(),d.map_is_open=!1)});var t=document.createElement("iframe");t.src="//pudofinder.dpd.com.pl/widget?key=1ae3418e27627ab52bebdcc1a958fa04"+(d.validate_cod?"&direct_delivery_cod=1":""),t.style.width="100%",t.style.border="none",t.style.minHeight="400px",c("#sensbitdpd-pudo-widget").append(t),d.validate_cod?c("."+d.module+"-map-container").addClass("cod"):c("."+d.module+"-map-container").removeClass("cod");var e=window[window.addEventListener?"addEventListener":"attachEvent"];e("attachEvent"==e?"onmessage":"message",function(e){e.data.height&&!isNaN(e.data.height)?t.style.height=e.data.height+"px":e.data.point_id&&sensbitdpd.updatePoint(e.data.point_id)},!1)}}String.prototype.repeat=function(e){return new Array(e+1).join(this)};var p={setOptions:function(e){void 0!==e.point&&(null!==e.point&&e.point||(e.point="")),c.extend(d,e),0<d.point.length&&p.updatePoint(d.point,"."+d.module+"-point-select")},debug:function(){return console.log(d),d},init:function(e){d.loaded||(void 0!==e&&p.setOptions(e),d.loaded=!0,d.id_interval=setInterval(function(){void 0!==c&&(c(function(){if(console.log(d.text_console,"font-size:18px;color:#e40037;"),o(),n(),c(document).on("change",d.carrier_selector,function(){o()}),d.use_interval)setInterval(function(){o()},500);c(document).on("change","."+d.module+"-point-select",function(){var e=c(this);p.updatePoint(e.val(),e)}),c(document).on("click",d.conf_btn+", input#cgv",function(e){d.point_required&&d.point.length<=0?(e.preventDefault(),c("."+d.module).addClass("error"),alert(d.text_choose_point),c(this).is(":checkbox")&&(c(d.conf_btn).prop("checked",!1),void 0!==c.uniform&&c.uniform.update(d.conf_btn)),c("."+d.module+"-map-btn").trigger("click")):c("."+d.module).removeClass("error")})}),clearInterval(d.id_interval))},300))},openMap:function(e,t){d.map_is_open||(n(),d.map_is_open=!0,c("."+d.module+"-map-container").fadeIn())},updatePoint:function(o,n){n=n||"."+d.module+"-point-select";d.map_is_open&&(c("."+d.module+"-map-container").fadeOut(),d.map_is_open=!1),c.ajax({url:d.ajax_url,type:"POST",dataType:"json",data:{ajax:1,action:"updatePoint",point:o,check_cod:d.validate_cod},success:function(e){var t;"0"===e?(d.point="",c(n).closest("."+d.module).find("."+d.select2+"-selection__rendered").text(""),t=d.text_point_cod,c.prototype.fancybox?c.fancybox.open([{type:"inline",autoScale:!0,minHeight:30,content:'<p class="fancybox-error">'+t+"</p>"}],{padding:0,helpers:{overlay:{locked:!1}}}):alert(t)):(d.point=o,c("."+d.module).removeClass("error"),void 0!==e.label&&c(n).closest("."+d.module).find("."+d.select2+"-selection__rendered").text(e.label))}})}};return p}($,window,document);